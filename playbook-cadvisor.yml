---
- name: Deploy cAdvisor on all Docker hosts
  hosts: postgres_master:postgres_replicas
  become: true
  gather_facts: yes
  
  roles:
    - role: cadvisor
  
  post_tasks:
    - name: Verify cAdvisor metrics endpoint
      uri:
        url: "http://localhost:9080/metrics"
        return_content: no
      register: cadvisor_check
      failed_when: cadvisor_check.status != 200

    - name: Display cAdvisor URL
      debug:
        msg: "âœ… cAdvisor deployed at http://{{ ansible_host }}:9080"